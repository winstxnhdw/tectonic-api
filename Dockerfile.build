FROM rust:slim-bullseye

RUN apt update && \
    apt install -y \
        g++ \
        pkg-config \
        libssl-dev \
        libfontconfig-dev \
        libharfbuzz-dev && \
    rm -rf /var/lib/apt/lists/* && \
    useradd -m -u 1000 user

ENV HOME=/home/user

USER user

WORKDIR $HOME/app

COPY --chown=user . $HOME/app

CMD ["cargo", "run", "--release"]
